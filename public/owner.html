<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Owner Dashboard | Sree Aadya Dry Cleaners</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:#f3f6fa;color:#333}
header{
  background:#0d47a1;color:#fff;padding:20px 40px;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 4px 10px rgba(0,0,0,0.15);
}
header h1{font-size:22px;font-weight:600}
header i{font-size:22px}

.container{
  max-width:1200px;margin:30px auto;background:#fff;
  padding:25px;border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
}

.dashboard-summary{
  display:flex;flex-wrap:wrap;gap:20px;margin-bottom:30px;
}
.card{
  flex:1;min-width:200px;background:#0d47a1;color:#fff;
  padding:20px;border-radius:10px;text-align:center;
  transition:0.3s;
}
.card:hover{transform:translateY(-5px);box-shadow:0 6px 15px rgba(0,0,0,0.15);}
.card h2{font-size:28px;margin-bottom:5px}
.card p{font-size:14px}

/* Table */
table{width:100%;border-collapse:collapse}
th,td{padding:12px 15px;border-bottom:1px solid #eee;text-align:left}
th{background:#0d47a1;color:#fff;text-transform:uppercase;font-size:13px}
tr:hover{background:#f9fcff}

/* Status badges */
.status{padding:6px 10px;border-radius:6px;color:#fff;font-weight:500;font-size:13px}
.status.OrderPlaced{background:#ff9800}
.status.InCleaning{background:#2196f3}
.status.ReadyforDelivery{background:#3f51b5}
.status.OutforDelivery{background:#673ab7}
.status.Delivered{background:#4caf50}

/* Dropdown + Buttons */
select.status-dropdown{
  padding:6px 8px;border-radius:5px;border:1px solid #ccc;
  font-size:13px;cursor:pointer;outline:none;
}
.delete-btn{
  background:#e53935;color:#fff;border:none;
  padding:7px 12px;border-radius:6px;font-size:13px;
  cursor:pointer;transition:0.3s;
}
.delete-btn:hover{background:#c62828}

/* Footer */
footer{
  text-align:center;padding:15px;margin-top:30px;
  background:#0d47a1;color:#fff;font-size:14px;
}
</style>
</head>

<body>
<header>
  <h1>Sree Aadya Dry Cleaners — Owner Dashboard</h1>
  <i class="fa-solid fa-user-tie"></i>
</header>

<div class="container">
  <div class="dashboard-summary">
    <div class="card"><h2 id="totalOrders">0</h2><p>Total Orders</p></div>
    <div class="card"><h2 id="pendingOrders">0</h2><p>Order Placed</p></div>
    <div class="card"><h2 id="inProgressOrders">0</h2><p>In Cleaning</p></div>
    <div class="card"><h2 id="readyOrders">0</h2><p>Ready for Delivery</p></div>
    <div class="card"><h2 id="deliveredOrders">0</h2><p>Delivered</p></div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Service</th>
        <th>Qty</th>
        <th>Total</th>
        <th>Status</th>
        <th>Change</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="ordersTableBody">
      <tr><td colspan="8" style="text-align:center;color:#888">Loading orders...</td></tr>
    </tbody>
  </table>
</div>

<footer>
  © 2025 Sree Aadya Dry Cleaners | Owner Management Portal
</footer>

<script>
async function loadOrders() {
  try {
    const res = await fetch("http://localhost:5000/api/orders");
    const orders = await res.json();
    displayOrders(orders);
    updateStats(orders);
  } catch (err) {
    console.error("Error loading orders:", err);
  }
}

function displayOrders(orders) {
  const tbody = document.getElementById("ordersTableBody");
  tbody.innerHTML = "";
  if (!orders || orders.length === 0) {
    tbody.innerHTML = `<tr><td colspan="8" style="text-align:center">No orders found</td></tr>`;
    return;
  }

  orders.forEach(order => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${order.orderId}</td>
      <td>${order.userEmail || "N/A"}</td>
      <td>${order.service}</td>
      <td>${order.quantity || 1}</td>
      <td>₹${order.totalPrice || order.price}</td>
      <td><span class="status ${order.status.replace(/\s/g,'')}">${order.status}</span></td>
      <td>
        <select class="status-dropdown" onchange="changeStatus('${order.orderId}', this.value)">
          <option value="Order Placed" ${order.status === "Order Placed" ? "selected":""}>Order Placed</option>
          <option value="In Cleaning" ${order.status === "In Cleaning" ? "selected":""}>In Cleaning</option>
          <option value="Ready for Delivery" ${order.status === "Ready for Delivery" ? "selected":""}>Ready for Delivery</option>
          <option value="Out for Delivery" ${order.status === "Out for Delivery" ? "selected":""}>Out for Delivery</option>
          <option value="Delivered" ${order.status === "Delivered" ? "selected":""}>Delivered</option>
        </select>
      </td>
      <td><button class="delete-btn" onclick="deleteOrder('${order.orderId}')">Delete</button></td>
    `;
    tbody.appendChild(tr);
  });
}

async function changeStatus(orderId, status) {
  try {
    const res = await fetch(`http://localhost:5000/api/orders/${orderId}`, {
      method: "PUT",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ status })
    });
    if (res.ok) {
      alert("✅ Status updated successfully!");
      loadOrders();
    } else {
      alert("⚠️ Failed to update status");
    }
  } catch (err) {
    console.error(err);
  }
}

async function deleteOrder(orderId) {
  if (!confirm("Delete this order?")) return;
  try {
    const res = await fetch(`http://localhost:5000/api/orders/${orderId}`, { method: "DELETE" });
    if (res.ok) {
      alert("🗑️ Order deleted successfully!");
      loadOrders();
    } else alert("Failed to delete");
  } catch (err) {
    console.error(err);
  }
}

function updateStats(orders) {
  document.getElementById("totalOrders").textContent = orders.length || 0;
  document.getElementById("pendingOrders").textContent = orders.filter(o => o.status === "Order Placed").length || 0;
  document.getElementById("inProgressOrders").textContent = orders.filter(o => o.status === "In Cleaning").length || 0;
  document.getElementById("readyOrders").textContent = orders.filter(o => o.status === "Ready for Delivery").length || 0;
  document.getElementById("deliveredOrders").textContent = orders.filter(o => o.status === "Delivered").length || 0;
}

loadOrders();
</script>
</body>
</html>
