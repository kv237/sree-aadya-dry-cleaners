<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SREE AADYA | Sign Up</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{
  height:100vh;display:flex;justify-content:center;align-items:center;
  background:url("https://i.etsystatic.com/29049262/r/il/be7c8e/7309187902/il_1588xN.7309187902_239w.jpg") no-repeat center center/cover;
  color:#fff;
}
.signup-container{
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(12px);
  padding:50px 40px;
  border-radius:20px;
  box-shadow:0 10px 40px rgba(0,0,0,0.6);
  width:380px;text-align:center;
}
.signup-container h1{font-size:28px;color:#2196f3;margin-bottom:10px;}
.signup-container p{color:#bbb;margin-bottom:25px;}
.input-group{position:relative;margin-bottom:18px;}
.input-group i{position:absolute;top:50%;transform:translateY(-50%);}
.input-group .fa-user,.input-group .fa-envelope,.input-group .fa-lock{left:14px;color:#2196f3;}
.input-group input{
  width:100%;padding:14px 45px 14px 42px;border-radius:10px;
  border:none;background:rgba(255,255,255,0.12);color:#fff;font-size:15px;transition:all 0.3s ease;
}
.input-group input:focus{background:rgba(255,255,255,0.22);outline:none;}
.input-group .toggle-eye{right:15px;color:#ccc;cursor:pointer;transition:0.3s;}
.input-group .toggle-eye:hover{color:#2196f3;}
button{
  width:100%;padding:14px;border:none;border-radius:10px;
  background:#2196f3;color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;
}
button:hover{background:#1976d2;transform:scale(1.03);}
.google-btn{margin-top:18px;display:flex;align-items:center;justify-content:center;gap:10px;background:#fff;color:#444;border:none;border-radius:10px;padding:12px;cursor:pointer;font-weight:600;transition:all 0.3s ease;}
.google-btn img{width:22px;height:22px;}
.google-btn:hover{background:#f1f1f1;transform:scale(1.03);}
.login-link{margin-top:20px;font-size:14px;}
.login-link a{color:#2196f3;text-decoration:none;}
.login-link a:hover{text-decoration:underline;}
.popup{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);
  justify-content:center;align-items:center;z-index:1000;
}
.popup-content{
  background:#fff;color:#111;border-radius:15px;padding:40px 30px;text-align:center;
  box-shadow:0 10px 40px rgba(0,0,0,0.4);width:90%;max-width:400px;
}
.popup-content h2{color:#2196f3;margin-bottom:10px;}
.popup-content button{background:#2196f3;color:#fff;border:none;padding:10px 22px;border-radius:10px;cursor:pointer;font-weight:600;margin-top:15px;transition:0.3s;}
.popup-content button:hover{background:#1976d2;}
</style>
</head>

<body>
<div class="signup-container">
  <h1>Create Account</h1>
  <p>Join <strong>Sree Aadya Dry Cleaners</strong> today</p>

  <form id="signupForm">
    <div class="input-group">
      <i class="fas fa-user"></i>
      <input type="text" id="name" placeholder="Full Name" required />
    </div>
    <div class="input-group">
      <i class="fas fa-envelope"></i>
      <input type="email" id="email" placeholder="Email Address" required />
    </div>
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" id="password" placeholder="Password" required />
      <i class="fas fa-eye toggle-eye" id="togglePassword"></i>
    </div>
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" id="confirmPassword" placeholder="Confirm Password" required />
      <i class="fas fa-eye toggle-eye" id="toggleConfirmPassword"></i>
    </div>

    <button type="submit">Sign Up</button>

    <!-- Google Sign-In -->
    <div id="g_id_signin" class="google-btn"></div>

    <div class="login-link">
      Already have an account? <a href="login.html">Login</a>
    </div>
  </form>
</div>

<!-- Popup -->
<div class="popup" id="successPopup">
  <div class="popup-content">
    <h2>Signup Successful!</h2>
    <p>Welcome to <strong>Sree Aadya Dry Cleaners</strong>. Redirecting to your dashboard...</p>
    <button onclick="goToDashboard()">Go Now</button>
  </div>
</div>

<!-- âœ… Google Sign-In SDK -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
// ðŸ‘ï¸ Toggle password
document.getElementById("togglePassword").onclick = () => {
  const f = document.getElementById("password");
  f.type = f.type === "password" ? "text" : "password";
};
document.getElementById("toggleConfirmPassword").onclick = () => {
  const f = document.getElementById("confirmPassword");
  f.type = f.type === "password" ? "text" : "password";
};

// âœ³ï¸ Manual signup
document.getElementById("signupForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const confirmPassword = document.getElementById("confirmPassword").value.trim();

  if (password !== confirmPassword) return alert("Passwords do not match!");

  try {
    const res = await fetch("http://localhost:5000/signup", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ name, email, password }),
    });

    const data = await res.json();
    if (res.ok) {
      document.getElementById("successPopup").style.display = "flex";
      setTimeout(() => window.location.href = "dashboard.html", 2500);
    } else alert(data.message || "Signup failed.");
  } catch (err) {
    console.error(err);
    alert("Error connecting to server.");
  }
});

function goToDashboard(){ window.location.href="dashboard.html"; }

// âœ… Initialize Google Sign-In properly
window.onload = function() {
  google.accounts.id.initialize({
    client_id: "965231085923-js980aremi5hgi3ne2qv914auafv36nd.apps.googleusercontent.com",
    callback: handleGoogleResponse
  });
  google.accounts.id.renderButton(
    document.getElementById("g_id_signin"),
    { theme: "outline", size: "large", width: "100%" }
  );
};

async function handleGoogleResponse(response) {
  try {
    const res = await fetch("http://localhost:5000/google-login", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ token: response.credential })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("user", JSON.stringify(data.user));
      window.location.href = "dashboard.html";
    } else {
      alert(data.message || "Google sign-in failed.");
    }
  } catch (error) {
    console.error(error);
    alert("Server error during Google login.");
  }
}
</script>
</body>
</html>
